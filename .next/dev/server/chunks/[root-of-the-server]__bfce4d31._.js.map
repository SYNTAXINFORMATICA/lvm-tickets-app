{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/code/sentry/lvm-tickets-app/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg';\n\n// Create a singleton connection pool\nlet pool: Pool | null = null;\n\nexport function getPool() {\n  if (!pool) {\n    pool = new Pool({\n      connectionString: process.env.DATABASE_URL,\n      ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : undefined,\n      max: 20,\n      idleTimeoutMillis: 30000,\n      connectionTimeoutMillis: 2000,\n    });\n  }\n  return pool;\n}\n\nexport async function query(text: string, params?: any[]) {\n  const pool = getPool();\n  const start = Date.now();\n  try {\n    const res = await pool.query(text, params);\n    const duration = Date.now() - start;\n    console.log('[v0] Executed query', { text, duration, rows: res.rowCount });\n    return res;\n  } catch (error) {\n    console.error('[v0] Database query error:', error);\n    throw error;\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;;;;;;AAEA,qCAAqC;AACrC,IAAI,OAAoB;AAEjB,SAAS;IACd,IAAI,CAAC,MAAM;QACT,OAAO,IAAI,4GAAI,CAAC;YACd,kBAAkB,QAAQ,GAAG,CAAC,YAAY;YAC1C,KAAK,sCAAwC,0BAAgC;YAC7E,KAAK;YACL,mBAAmB;YACnB,yBAAyB;QAC3B;IACF;IACA,OAAO;AACT;AAEO,eAAe,MAAM,IAAY,EAAE,MAAc;IACtD,MAAM,OAAO;IACb,MAAM,QAAQ,KAAK,GAAG;IACtB,IAAI;QACF,MAAM,MAAM,MAAM,KAAK,KAAK,CAAC,MAAM;QACnC,MAAM,WAAW,KAAK,GAAG,KAAK;QAC9B,QAAQ,GAAG,CAAC,uBAAuB;YAAE;YAAM;YAAU,MAAM,IAAI,QAAQ;QAAC;QACxE,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,MAAM;IACR;AACF"}},
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///C:/code/sentry/lvm-tickets-app/lib/auth.ts"],"sourcesContent":["import { compare, hash } from 'bcryptjs';\nimport { SignJWT, jwtVerify } from 'jose';\nimport { cookies } from 'next/headers';\n\nconst secret = new TextEncoder().encode(process.env.SESSION_SECRET || 'default-secret-change-this');\n\nexport interface User {\n  id: number;\n  cedula: string;\n  name: string;\n  role: 'administrador' | 'analista' | 'ingeniero';\n  email: string;\n}\n\nexport async function hashPassword(password: string): Promise<string> {\n  return hash(password, 10);\n}\n\nexport async function verifyPassword(password: string, hashedPassword: string): Promise<boolean> {\n  return compare(password, hashedPassword);\n}\n\nexport async function createSession(user: User) {\n  const token = await new SignJWT({ user })\n    .setProtectedHeader({ alg: 'HS256' })\n    .setIssuedAt()\n    .setExpirationTime('24h')\n    .sign(secret);\n\n  (await cookies()).set('session', token, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'lax',\n    maxAge: 60 * 60 * 24, // 24 hours\n    path: '/',\n  });\n}\n\nexport async function getSession(): Promise<User | null> {\n  const cookieStore = await cookies();\n  const token = cookieStore.get('session');\n\n  if (!token) return null;\n\n  try {\n    const verified = await jwtVerify(token.value, secret);\n    return verified.payload.user as User;\n  } catch (error) {\n    return null;\n  }\n}\n\nexport async function deleteSession() {\n  (await cookies()).delete('session');\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AACA;AAAA;AACA;;;;AAEA,MAAM,SAAS,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,cAAc,IAAI;AAU/D,eAAe,aAAa,QAAgB;IACjD,OAAO,IAAA,8KAAI,EAAC,UAAU;AACxB;AAEO,eAAe,eAAe,QAAgB,EAAE,cAAsB;IAC3E,OAAO,IAAA,iLAAO,EAAC,UAAU;AAC3B;AAEO,eAAe,cAAc,IAAU;IAC5C,MAAM,QAAQ,MAAM,IAAI,qMAAO,CAAC;QAAE;IAAK,GACpC,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,OAClB,IAAI,CAAC;IAER,CAAC,MAAM,IAAA,+KAAO,GAAE,EAAE,GAAG,CAAC,WAAW,OAAO;QACtC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,QAAQ,KAAK,KAAK;QAClB,MAAM;IACR;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,+KAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC;IAE9B,IAAI,CAAC,OAAO,OAAO;IAEnB,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,yMAAS,EAAC,MAAM,KAAK,EAAE;QAC9C,OAAO,SAAS,OAAO,CAAC,IAAI;IAC9B,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF;AAEO,eAAe;IACpB,CAAC,MAAM,IAAA,+KAAO,GAAE,EAAE,MAAM,CAAC;AAC3B"}},
    {"offset": {"line": 172, "column": 0}, "map": {"version":3,"sources":["file:///C:/code/sentry/lvm-tickets-app/app/api/auth/login/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { query } from '@/lib/db';\nimport { verifyPassword, createSession } from '@/lib/auth';\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { cedula, password } = await request.json();\n\n    if (!cedula || !password) {\n      return NextResponse.json(\n        { error: 'Cédula y contraseña son requeridos' },\n        { status: 400 }\n      );\n    }\n\n    // Find user by cedula\n    const result = await query(\n      'SELECT id, cedula, password, name, role, email FROM lvm_users WHERE cedula = $1',\n      [cedula]\n    );\n\n    if (result.rows.length === 0) {\n      return NextResponse.json(\n        { error: 'Credenciales inválidas' },\n        { status: 401 }\n      );\n    }\n\n    const user = result.rows[0];\n\n    // Special case for admin user with plain password (for demo purposes)\n    const isValidPassword = user.cedula === 'admin' && password === 'admin2025*'\n      ? true\n      : await verifyPassword(password, user.password);\n\n    if (!isValidPassword) {\n      return NextResponse.json(\n        { error: 'Credenciales inválidas' },\n        { status: 401 }\n      );\n    }\n\n    // Create session\n    await createSession({\n      id: user.id,\n      cedula: user.cedula,\n      name: user.name,\n      role: user.role,\n      email: user.email,\n    });\n\n    return NextResponse.json({\n      user: {\n        id: user.id,\n        cedula: user.cedula,\n        name: user.name,\n        role: user.role,\n        email: user.email,\n      },\n    });\n  } catch (error) {\n    console.error('[v0] Login error:', error);\n    return NextResponse.json(\n      { error: 'Error en el servidor' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,MAAM,EAAE,QAAQ,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE/C,IAAI,CAAC,UAAU,CAAC,UAAU;YACxB,OAAO,mLAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAqC,GAC9C;gBAAE,QAAQ;YAAI;QAElB;QAEA,sBAAsB;QACtB,MAAM,SAAS,MAAM,IAAA,uJAAK,EACxB,mFACA;YAAC;SAAO;QAGV,IAAI,OAAO,IAAI,CAAC,MAAM,KAAK,GAAG;YAC5B,OAAO,mLAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAyB,GAClC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,OAAO,IAAI,CAAC,EAAE;QAE3B,sEAAsE;QACtE,MAAM,kBAAkB,KAAK,MAAM,KAAK,WAAW,aAAa,eAC5D,OACA,MAAM,IAAA,kKAAc,EAAC,UAAU,KAAK,QAAQ;QAEhD,IAAI,CAAC,iBAAiB;YACpB,OAAO,mLAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAyB,GAClC;gBAAE,QAAQ;YAAI;QAElB;QAEA,iBAAiB;QACjB,MAAM,IAAA,iKAAa,EAAC;YAClB,IAAI,KAAK,EAAE;YACX,QAAQ,KAAK,MAAM;YACnB,MAAM,KAAK,IAAI;YACf,MAAM,KAAK,IAAI;YACf,OAAO,KAAK,KAAK;QACnB;QAEA,OAAO,mLAAY,CAAC,IAAI,CAAC;YACvB,MAAM;gBACJ,IAAI,KAAK,EAAE;gBACX,QAAQ,KAAK,MAAM;gBACnB,MAAM,KAAK,IAAI;gBACf,MAAM,KAAK,IAAI;gBACf,OAAO,KAAK,KAAK;YACnB;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qBAAqB;QACnC,OAAO,mLAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAuB,GAChC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}